<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jstl/core_rt" prefix="c"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<!doctype html>
<html lang="en">

<head>
<title>Title</title>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">


<!-- Bootstrap CSS v5.2.1 -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT"
	crossorigin="anonymous">

<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />

<link rel="stylesheet" type="text/css"
	href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />

<!-- font awesome style -->
<link href="/css/font-awesome.min.css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="/css/bootstrap.css" />
<!-- Custom styles for this template -->
<link href="/css/style.css" rel="stylesheet" type="text/css" />

<!-- responsive style -->
<link href="/css/responsive.css" rel="stylesheet" />
<link href="/css/stylegh.css" rel="stylesheet" type="text/css" />
<style type="text/css">
.center-btn {
	display: block;
	margin-left: auto;
	margin-right: auto;
	font-size: 20px;
}
</style>
</head>
<body>
	<%@include file="/WEB-INF/views/header/header.jsp"%>
	<section class="breadcrumb-section bg-white">
		<div class="container">
			<div class="row">
				<div class="col-lg-12 text-center">
					<div class="">
						<h2>Giỏ Hàng</h2>
					</div>
				</div>
			</div>
		</div>
	</section>
	<section class="shoping-cart spad bg-white">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<div class="shoping__cart__table">
						<table>
							<thead>
								<tr>
									<th class="shoping__product">Sản phẩm</th>
									<th>Giá</th>
									<th>Số lượng</th>
									<th>Tổng tiền</th>
									<th></th>
								</tr>
							</thead>
							<tbody>
								<c:set var="tongTien" value="0" />
								<c:forEach var="item" items="${cart}">
									<form action="/updateQuantity" method="post">
										<tr>
											<td class="shoping__cart__item"><img
												src="/images/${item.sanpham.hinhanh}" alt="">
												<h5>${item.sanpham.tensp}</h5></td>
											<td class="shoping__cart__price"><fmt:formatNumber
													value="${item.sanpham.gia}" pattern="#,### đ" /></td>
											<td class="shoping__cart__quantity">
												<div class="quantity">
													<div class="pro-qty">
														<button class="btn btn-link px-2"
															onclick="this.parentNode.querySelector('input[type=number]').stepDown()">
															<i class="fas fa-minus"></i>
														</button>
														<input id="form1" min="1" name="soluong"
															value="${item.soluong}" type="number"
															onblur="this.form.submit()"
															class="form-control form-control-sm" style="width: 50px"
															readonly onkeydown="return false;" />
														<button class="btn btn-link px-2"
															onclick="this.parentNode.querySelector('input[type=number]').stepUp()">
															<i class="fas fa-plus"></i>
														</button>
													</div>
												</div>
											</td>
											<c:set var="soluong" value="${item.soluong}" />
											<c:set var="gia" value="${item.sanpham.gia}" />
											<c:set var="tongGia" value="${soluong * gia}" />
											<c:set var="tongTien" value="${tongTien + tongGia}" />
											<td class="shoping__cart__total"><fmt:formatNumber
													value="${tongGia}" pattern="#,### đ" /></td>
											<td class="shoping__cart__item__close"><a
												href="/delete/${item.id}" class="text-muted"><i
													class="fa fa-times-circle" aria-hidden="true"></i></a>
											<td><input type="hidden" name="id" value="${item.id}">


											</td>


										</tr>
									</form>
								</c:forEach>

							</tbody>
						</table>
					</div>
				</div>
			</div>
			<form action="/thanhtoan" method="post">
				<div class="row">

					<div class="col-lg-12">
						<div class="shoping__cart__btns ">
							<a href="/watches"
								class="primary-btn cart-btn bg-success text-white">Mua thêm</a>
						</div>
					</div>
					<div class="col-lg-6">
						<div class="shoping__continue">
							<div class="shoping__discount">
								<h5>Đơn vị giao hàng</h5>
								<form action="#">
									<input type="text" placeholder="Shoppe 50,000đ" disabled="true">
									<button type="submit" class="site-btn">Chọn</button>
									<br>

								</form>


							</div>
							<div class="row">
								<h4 class="m-3">Thông tin khách hàng</h4>
								<div class="col">
									<label for="">Họ và tên:</label> <input type="text"
										name="hoten" value="${hotenkh}" class="form-control"
										placeholder="Họ tên" aria-label="name"><br> <label
										for="">Địa chỉ nhận hàng:</label> <input type="text"
										name="diachi" value="${diachi}" class="form-control"
										placeholder="Xin vui lòng nhập địa chỉ của bạn"
										aria-label="adress"><br>
								</div>

								<div class="col">

									<label for="">Số điện thoại:</label> <input type="text"
										name="sdt" value="${sdt}" class="form-control"
										placeholder="Xin vui lòng nhập số điện thoại "
										aria-label="phone"> <br> <label for="">Ghi
										Chú:</label> <input type="text" class="form-control" name="ghichu"
										aria-label="phone" value="Ghi Chú">
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-6">
						<div class="shoping__checkout">

							<h5>Tổng tiền giỏ hàng</h5>
							<ul>
								<li>Phí giao hàng <span>50,000đ</span></li>
								<li>Tổng tiền sản phẩm <span><fmt:formatNumber
											value="${tongTien}" pattern="#,### đ" /></span></li>
								<c:set var="tongTien" value="${tongTien + 50000}" />

								<li>Tộng cộng: <span> <fmt:formatNumber
											value="${tongTien}" pattern="#,### đ" /></span></li>
								<input type="hidden" name="tongTien" value="${tongTien}" />
								<input type="hidden" name="idgiohang" value="${idgiohang}" />
								<button type="submit" class="btn btn-warning center-btn"
									style="width: 300px">Đặt hàng</button>


							</ul>

						</div>
					</div>

				</div>
			</form>
		</div>
	</section>
	<%@include file="/WEB-INF/views/footer/footer.jsp"%>

	<!-- jQery -->
	<script src="/js/jquery-3.4.1.min.js"></script>
	<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
	<script>
	function removeSuccessParamFromURL() {
	    if (window.history && window.history.replaceState) {
	        var url = window.location.href;
	        var urlParams = new URLSearchParams(window.location.search);
	        urlParams.delete('success');
	        var newURL = url.split('?')[0] + '?' + urlParams.toString();
	        window.history.replaceState({}, '', newURL);
	    }
	}
		// Kiểm tra query parameter và hiển thị thông báo thành công
		window.onload = function() {
			var urlParams = new URLSearchParams(window.location.search);
			var successParam = urlParams.get('success');
			if (successParam === 'true') {
				showSuccessMessage("Thêm sản phẩm thành công");
				removeSuccessParamFromURL();
			}if (successParam === 'xoasp') {
				showSuccessMessage("Xóa sản phẩm thành công");
				removeSuccessParamFromURL();
			}
		}

		function showSuccessMessage(message) {
			swal("Thông báo", message, "success");
		}
	</script>
	<!-- owl slider -->
	<script
		src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
		integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
		crossorigin="anonymous">
		
	</script>
	<!-- bootstrap js -->
	<script src="js/bootstrap.js"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js">
		
	</script>

	<!-- custom js -->
	<script src="js/custom.js"></script>
</body>

</html>